<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EQAS Program Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    .program-card { transition: all 0.3s ease; cursor: pointer; }
    .program-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,77,153,0.15); }
    .modal-overlay { z-index: 1000; background: rgba(0,0,0,.6); backdrop-filter: blur(5px); transition: opacity .3s; }
    .modal-content { max-height: 90vh; }
    .modal-content-overflow { overflow-y: auto; }
    @media (min-width:1024px){ .sidebar-height{ height:100vh; position:sticky; top:0; } }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-white shadow-md z-10">
    <div class="px-4 sm:px-6 lg:px-8 lg:ml-[250px] py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-800">EQAS Program Dashboard</h1>
      <span class="text-sm text-gray-500">Select a Scheme</span>
    </div>
  </header>

  <div class="flex flex-grow w-full">
    <!-- Sidebar -->
    <aside class="sidebar-height w-full lg:w-[250px] mb-8 lg:mb-0 bg-white p-6 shadow-xl border-t-4 lg:border-t-0 lg:border-r border-gray-300 flex-shrink-0">
      <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-3">Main Navigation</h3>
      <nav class="space-y-3">
        <a href="#" class="flex items-center p-3 rounded-lg bg-blue-50 text-blue-700 font-semibold hover:bg-blue-100">
          <span class="mr-3 text-2xl">üìù</span> Enrolment
        </a>
        <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100">
          <span class="mr-3 text-2xl text-teal-600">‚úÖ</span> Programs Enrolled
        </a>
        <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100">
          <span class="mr-3 text-2xl text-yellow-600">üë§</span> Registration Details
        </a>
        <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100">
          <span class="mr-3 text-2xl text-pink-600">üì¢</span> Announcements
        </a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="flex-grow py-12 px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-extrabold text-gray-900 mb-6">Enrollment Schemes</h2>

      <!-- Program Cards -->
      <div id="program-cards-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-8">
        <!-- MPQAP -->
        <div class="program-card bg-white p-6 rounded-xl shadow-lg border-t-4 border-blue-600" data-program="mpqap">
          <div class="text-4xl mb-4 text-blue-600">üî¨</div>
          <h2 class="text-xl font-semibold text-gray-800 mb-2">MPQAP</h2>
          <p class="text-gray-500 text-sm">Molecular Pathology Quality Assurance Program. Focuses on DNA/RNA testing proficiency.</p>
          <button class="mt-4 text-blue-600 font-medium hover:text-blue-800">Enrollment Details ‚Üí</button>
        </div>

        <!-- CBQAP -->
        <div class="program-card bg-white p-6 rounded-xl shadow-lg border-t-4 border-teal-600" data-program="cbqap">
          <div class="text-4xl mb-4 text-teal-600">üß¨</div>
          <h2 class="text-xl font-semibold text-gray-800 mb-2">CBQAP</h2>
          <p class="text-gray-500 text-sm">Clinical Biochemistry Quality Assurance Program. Covers general chemistry and clinical assays.</p>
          <button class="mt-4 text-teal-600 font-medium hover:text-teal-800">Enrollment Details ‚Üí</button>
        </div>

        <!-- NCG EQAS -->
        <div class="program-card bg-white p-6 rounded-xl shadow-lg border-t-4 border-yellow-600" data-program="ncgeqas">
          <div class="text-4xl mb-4 text-yellow-600">üèõÔ∏è</div>
          <h2 class="text-xl font-semibold text-gray-800 mb-2">NCG EQAS</h2>
          <p class="text-gray-500 text-sm">National Centralized Genomic EQAS. For high-throughput next-generation sequencing labs.</p>
          <button class="mt-4 text-yellow-600 font-medium hover:text-yellow-800">Enrollment Details ‚Üí</button>
        </div>

        <!-- CYTOEQAS -->
        <div class="program-card bg-white p-6 rounded-xl shadow-lg border-t-4 border-pink-600" data-program="cytoeqas">
          <div class="text-4xl mb-4 text-pink-600">ü¶†</div>
          <h2 class="text-xl font-semibold text-gray-800 mb-2">CYTOEQAS</h2>
          <p class="text-gray-500 text-sm">Cytopathology External Quality Assessment Scheme. Focuses on smear and cell morphology.</p>
          <button class="mt-4 text-pink-600 font-medium hover:text-pink-800">Enrollment Details ‚Üí</button>
        </div>

        <!-- Modules enrolled + Payment Brackets -->
        <div id="enrolled-card" class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-purple-600 col-span-1 sm:col-span-2 md:col-span-3 xl:col-span-4">
          <div class="flex flex-col gap-4">
            <div class="flex items-start justify-between">
              <div class="w-full">
                <div class="flex items-center gap-3 flex-wrap">
                  <h3 class="text-xl font-semibold text-gray-800">Modules enrolled</h3>
                  <button id="reset-brackets"
                    class="text-xs font-medium text-red-600 hover:text-red-700 hover:underline rounded px-2 py-0.5 bg-red-50">
                    Reset
                  </button>
                </div>
                <p class="text-gray-500 text-sm mt-1">Separate payments need to be made for each enrolled module</p>
              </div>

              <div id="total-box" class="hidden text-right ml-6">
                <div class="text-xs uppercase text-gray-400">Estimated Total</div>
                <div id="total-amount" class="text-lg font-semibold text-gray-800">‚Çπ0</div>
              </div>
            </div>


            <!-- Chips -->
            <div id="enrolled-list" class="mt-1 flex flex-wrap gap-2"></div>

            <!-- Payment Brackets Grid -->
            <div id="payment-brackets" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 mt-4">
              <!-- JS will inject one card per program -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6 mt-auto">
    <div class="px-4 sm:px-6 lg:px-8 lg:ml-[250px] text-center lg:text-left">
      <p class="text-sm">&copy; 2025 EQAS Solutions. Quality Assurance for Laboratory Excellence.</p>
    </div>
  </footer>

  <!-- Modal -->
  <div id="enrollment-modal" class="modal-overlay fixed inset-0 hidden items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-xl modal-content transform transition-all duration-300 scale-95 opacity-0">
      <div class="p-6 border-b flex justify-between items-center">
        <h3 id="modal-title" class="text-2xl font-bold text-gray-800">Enrollment for [Program Name]</h3>
        <button id="close-modal" class="text-gray-400 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100 transition">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="p-6 modal-content-overflow">
        <form id="enrollment-form">
          <div id="form-content" class="space-y-4">
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label for="lab-name" class="block text-sm font-medium text-gray-700">Laboratory Name</label>
                <input type="text" id="lab-name" name="lab-name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
              </div>
              <div>
                <label for="contact-person" class="block text-sm font-medium text-gray-700">Contact Person</label>
                <input type="text" id="contact-person" name="contact-person" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
              </div>
            </div>
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
              <input type="email" id="email" name="email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
            </div>

            <div id="program-specific-fields"></div>

            <div class="pt-4">
              <button type="submit" class="w-full flex justify-center py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">
                Confirm Enrollment Request
              </button>
            </div>
          </div>
        </form>

        <div id="success-message" class="hidden p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg mt-4" role="alert">
          <p class="font-bold">Success!</p>
          <p>Your enrollment request for <span id="success-program-name"></span> has been submitted. We will contact you shortly.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== CONFIGURE PAYMENT BRACKETS HERE ======
    // feeINR is display-only here; route links can be internal or external.
    const PAYMENT_BRACKETS = {
      mpqap: { label: "MPQAP",  feeINR: 7500, route: "/pay/mpqap"  },
      cbqap: { label: "CBQAP",  feeINR: 6500, route: "/pay/cbqap"  },
      ncgeqas: { label: "NCG EQAS", feeINR: 12000, route: "/pay/ncgeqas" },
      cytoeqas: { label: "CYTOEQAS", feeINR: 5500, route: "/pay/cytoeqas" }
    };

    const modal = document.getElementById('enrollment-modal');
    const modalContent = modal.querySelector('.modal-content');
    const closeModalButton = document.getElementById('close-modal');
    const programCards = document.querySelectorAll('.program-card');
    const modalTitle = document.getElementById('modal-title');
    const formContent = document.getElementById('program-specific-fields');
    const enrollmentForm = document.getElementById('enrollment-form');
    const successMessage = document.getElementById('success-message');
    const successProgramName = document.getElementById('success-program-name');

    const enrolledList = document.getElementById('enrolled-list');
    const paymentGrid = document.getElementById('payment-brackets');
    const totalBox = document.getElementById('total-box');
    const totalAmount = document.getElementById('total-amount');

    // --- Form Templates ---
    const formTemplates = {
      mpqap: `
        <h4 class="font-semibold text-blue-600 border-b pb-2">MPQAP Specific Details</h4>
        <div>
          <label class="block text-sm font-medium text-gray-700">Molecular Platform Used</label>
          <select name="platform" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
            <option value="">Select Platform</option>
            <option value="pcr">Real-time PCR</option>
            <option value="sequencing">Sanger Sequencing</option>
            <option value="ngs">NGS</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Primary Assays of Interest</label>
          <input type="text" name="assays" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
        </div>
      `,
      cbqap: `
        <h4 class="font-semibold text-teal-600 border-b pb-2">CBQAP Specific Details</h4>
        <div>
          <label class="block text-sm font-medium text-gray-700">Primary Chemistry Analyzer Model</label>
          <input type="text" name="analyzer" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
        </div>
        <div class="flex items-center">
          <input id="accreditation" name="accreditation" type="checkbox" class="h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
          <label for="accreditation" class="ml-2 block text-sm text-gray-900">Seeking ISO 15189 accreditation support?</label>
        </div>
      `,
      ncgeqas: `
        <h4 class="font-semibold text-yellow-600 border-b pb-2">NCG EQAS Specific Details</h4>
        <div>
          <label class="block text-sm font-medium text-gray-700">Estimated Annual NGS Sample Throughput</label>
          <select name="throughput" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
            <option value="">Select Range</option>
            <option value="low">1-100 Samples</option>
            <option value="medium">101-500 Samples</option>
            <option value="high">500+ Samples</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Bioinformatics Pipeline Used</label>
          <input type="text" name="bioinformatics" placeholder="e.g., DRAGEN, custom pipeline" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
        </div>
      `,
      cytoeqas: `
        <h4 class="font-semibold text-pink-600 border-b pb-2">CYTOEQAS Specific Details</h4>
        <div>
          <label class="block text-sm font-medium text-gray-700">Cytology Type</label>
          <select name="type" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
            <option value="">Select Primary Focus</option>
            <option value="gyn">Gynaecological (Pap Smear)</option>
            <option value="non-gyn">Non-Gynaecological (FNAC, Fluid)</option>
            <option value="histology">Histology/Virtual Microscopy</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Average Monthly Sample Volume</label>
          <input type="number" name="volume" required min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
        </div>
      `
    };

    // Modal show/hide
    function showModal(programName, programKey) {
      modalTitle.textContent = `Enrollment for ${programName}`;
      formContent.innerHTML = formTemplates[programKey];
      enrollmentForm.setAttribute('data-program-key', programKey);
      enrollmentForm.style.display = 'block';
      successMessage.classList.add('hidden');
      modal.classList.remove('hidden','opacity-0'); modal.classList.add('flex');
      setTimeout(()=>{ modalContent.classList.remove('scale-95','opacity-0'); modalContent.classList.add('scale-100','opacity-100'); },50);
    }
    function hideModal() {
      modalContent.classList.remove('scale-100','opacity-100'); modalContent.classList.add('scale-95','opacity-0');
      setTimeout(()=>{ modal.classList.add('hidden','opacity-0'); modal.classList.remove('flex'); enrollmentForm.reset(); },300);
    }

    // Click handlers (skip the enrolled summary card)
    programCards.forEach(card=>{
      if(card.id==='enrolled-card') return;
      card.addEventListener('click', ()=>{
        const key = card.getAttribute('data-program');
        const name = card.querySelector('h2').textContent;
        showModal(name, key);
      });
    });
    closeModalButton.addEventListener('click', hideModal);
    modal.addEventListener('click', (e)=>{ if(e.target===modal) hideModal(); });

    // Enrolled storage (key+name)
    function getEnrolled(){ try{ return JSON.parse(localStorage.getItem('enrolledModules')||'[]'); } catch{ return []; } }
    function setEnrolled(arr){ localStorage.setItem('enrolledModules', JSON.stringify(arr)); }

    // Render chips + payment brackets
    function renderEnrolledUI(){
      const items = getEnrolled(); // [{key,name}]
      enrolledList.innerHTML = '';
      paymentGrid.innerHTML = '';
      let total = 0;

      if(items.length===0){
        enrolledList.innerHTML = `<span class="text-gray-400 text-sm">No modules yet.</span>`;
        totalBox.classList.add('hidden');
        return;
      }

      // chips
      items.forEach(({name})=>{
        const chip = document.createElement('span');
        chip.className = 'inline-flex items-center px-3 py-1 rounded-full bg-purple-50 text-purple-700 border border-purple-200 text-sm';
        chip.textContent = name;
        enrolledList.appendChild(chip);
      });

      // brackets
      items.forEach(({key, name})=>{
        const bracket = PAYMENT_BRACKETS[key];
        const fee = bracket?.feeINR ?? 0;
        total += fee;

        const div = document.createElement('div');
        div.className = 'border rounded-xl p-4 shadow-sm bg-white flex flex-col justify-between';
        div.innerHTML = `
          <div>
            <div class="text-sm uppercase tracking-wide text-gray-400">Payment Bracket</div>
            <h4 class="text-lg font-semibold text-gray-900 mt-1">${name}</h4>
            <p class="text-gray-500 text-sm mt-1">Annual program fee</p>
            <div class="mt-3 text-2xl font-bold">‚Çπ${fee.toLocaleString('en-IN')}</div>
          </div>
          <div class="mt-4 flex items-center gap-2">
            <a href="payment.html" class="inline-flex items-center justify-center px-4 py-2 rounded-lg text-white bg-purple-600 hover:bg-purple-700 shadow transition">Pay for ${name} ‚Üí</a>
            <a href="fees/${key}" class="text-sm text-gray-500 hover:text-gray-700 underline">Fee details</a>
          </div>
        `;
        paymentGrid.appendChild(div);
      });

      totalBox.classList.remove('hidden');
      totalAmount.textContent = `‚Çπ${total.toLocaleString('en-IN')}`;
    }
    document.getElementById('reset-brackets').addEventListener('click', () => {
      if (confirm("Reset all enrolled modules and payment brackets?")) {
        localStorage.removeItem('enrolledModules');
        renderEnrolledUI();
      }
    });

    // Form submit -> save enrollment + refresh UI
    enrollmentForm.addEventListener('submit', function(e){
      e.preventDefault();
      const key = this.getAttribute('data-program-key');
      const name = document.querySelector(`.program-card[data-program="${key}"] h2`).textContent;

      enrollmentForm.style.opacity = '0.5';
      setTimeout(()=>{
        enrollmentForm.style.display='none'; enrollmentForm.style.opacity='1';
        successProgramName.textContent = name; successMessage.classList.remove('hidden');

        const current = getEnrolled(); // [{key,name}]
        if(!current.some(x=>x.key===key)) current.push({ key, name });
        setEnrolled(current);
        renderEnrolledUI();
      },800);
    });

    // Initial paint
    renderEnrolledUI();
  </script>
</body>
</html>
